<!-- User Create/Edit Modal -->
<div class="modal fade" id="userFormModal" #userFormModal tabindex="-1" aria-labelledby="userFormModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="userFormModalLabel">{{ isEditMode ? 'Editar Usuario' : 'Crear Usuario' }}</h5>
        <button type="button" class="btn-close" aria-label="Close" (click)="onCancel()"></button>
      </div>
      <div class="modal-body">
        <form [formGroup]="userForm" (ngSubmit)="onSubmit()">
          <div class="mb-3">
            <label for="username" class="form-label">Username</label>
            <input type="text" id="username" class="form-control" formControlName="username"
                   [ngClass]="{ 'is-invalid': f['username'].touched && f['username'].errors }">
            <div *ngIf="f['username'].touched && f['username'].errors" class="invalid-feedback">
              <div *ngIf="f['username'].errors['required']">El Username es requerido.</div>
              <div *ngIf="f['username'].errors['minlength']">El Username debe tener al menos 3 caracteres.</div>
              <div *ngIf="f['username'].errors['maxlength']">El Username no puede exceder los 50 caracteres.</div>
            </div>
          </div>

          <!-- fullName and Email fields will be displayed but changes won't be saved directly via this form -->
          <div class="mb-3">
            <label for="fullName" class="form-label">Nombre Completo</label>
            <input type="text" id="fullName" class="form-control" formControlName="fullName"
                   [ngClass]="{ 'is-invalid': f['fullName'].touched && f['fullName'].errors }">
            <div *ngIf="f['fullName'].touched && f['fullName'].errors" class="invalid-feedback">
              <div *ngIf="f['fullName'].errors['required']">El Nombre Completo es requerido.</div>
              <div *ngIf="f['fullName'].errors['minlength']">El Nombre Completo debe tener al menos 3 caracteres.</div>
              <div *ngIf="f['fullName'].errors['maxlength']">El Nombre Completo no puede exceder los 100 caracteres.</div>
            </div>
          </div>

          <div class="mb-3">
            <label for="email" class="form-label">Email</label>
            <input type="email" id="email" class="form-control" formControlName="email"
                   [ngClass]="{ 'is-invalid': f['email'].touched && f['email'].errors }">
            <div *ngIf="f['email'].touched && f['email'].errors" class="invalid-feedback">
              <div *ngIf="f['email'].errors['required']">El Email es requerido.</div>
              <div *ngIf="f['email'].errors['email']">El Email debe ser v치lido.</div>
              <div *ngIf="f['email'].errors['maxlength']">El Email no puede exceder los 100 caracteres.</div>
            </div>
          </div>

          <div class="mb-3" *ngIf="!isEditMode">
            <label for="password" class="form-label">Password</label>
            <input type="password" id="password" class="form-control" formControlName="password"
                   [ngClass]="{ 'is-invalid': f['password'].touched && f['password'].errors }">
            <div *ngIf="f['password'].touched && f['password'].errors" class="invalid-feedback">
              <div *ngIf="f['password'].errors['required']">La Contrase침a es requerida.</div>
              <div *ngIf="f['password'].errors['minlength']">La Contrase침a debe tener al menos 6 caracteres.</div>
              <div *ngIf="f['password'].errors['maxlength']">La Contrase침a no puede exceder los 120 caracteres.</div>
            </div>
          </div>

          <div class="mb-3">
            <label for="role" class="form-label">Rol</label>
            <select id="role" class="form-select" formControlName="role"
                    [ngClass]="{ 'is-invalid': f['role'].touched && f['role'].errors }">
              <option value="" disabled>Seleccione un Rol</option>
              <option *ngFor="let role of availableRoles" [value]="role">{{ role }}</option>
            </select>
            <div *ngIf="f['role'].touched && f['role'].errors" class="invalid-feedback">
              <div *ngIf="f['role'].errors['required']">El Rol es requerido.</div>
            </div>
          </div>

          <div class="mb-3 form-check">
            <input type="checkbox" id="estado" class="form-check-input" formControlName="estado">
            <label class="form-check-label" for="estado">Activo</label>
          </div>

          <div class="modal-footer d-flex justify-content-end">
            <button type="button" class="btn btn-secondary me-2" (click)="onCancel()">Cancelar</button>
            <button type="submit" class="btn btn-primary" [disabled]="userForm.invalid">
              {{ isEditMode ? 'Guardar Cambios' : 'Crear Usuario' }}
            </button>
          </div>
        </form>
      </div>
    </div>
  </div>
</div>
